<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <style>
    :root { --stumni-dark-blue: #0A2540; --stumni-gold: #FFC107; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8f9fa; }
    .sidebar { background-color: var(--stumni-dark-blue); color: white; }
    .sidebar .nav-link { color: white; font-weight: 500; transition: background-color 0.2s, color 0.2s; }
    .sidebar .nav-link:hover, .sidebar .nav-link.active { background-color: var(--stumni-gold); color: var(--stumni-dark-blue); border-radius: 5px; }
    @media (min-width: 768px) { .sidebar { min-height: 100vh; } }
    .navbar-toggler-icon { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%28255, 255, 255, 0.8%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e"); }
    .content { padding: 2rem; }
    .section { display: none; animation: fadeIn 0.5s; }
    .section.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .profile-pic { width: 150px; height: 150px; object-fit: cover; border: 4px solid var(--stumni-gold); }
  </style>
</head>
<body>
<div class="container-fluid">
  <div class="row">
    <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse p-3">
      <h3 class="text-center mb-4 d-none d-md-block">Dashboard</h3>
      <ul class="nav flex-column">
        <li class="nav-item"><a class="nav-link active" href="#" data-target="overview"><i class="bi bi-house me-2"></i> Overview</a></li>
        <li class="nav-item"><a class="nav-link" href="#" data-target="projects"><i class="bi bi-kanban me-2"></i> Projects</a></li>
        <li class="nav-item"><a class="nav-link" href="#" data-target="events"><i class="bi bi-calendar-event me-2"></i> Events</a></li>
        <li class="nav-item"><a class="nav-link" href="#" data-target="mentors"><i class="bi bi-people me-2"></i> Mentors</a></li>
        <li class="nav-item mt-auto"><a class="nav-link" href="/"><i class="bi bi-box-arrow-left me-2"></i> Logout</a></li>
      </ul>
    </nav>
    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 content">
      <h2 class="border-bottom pb-2 mb-4">Hello, <%= user.username %> ðŸ‘‹</h2>
      <div id="overview" class="section active text-center">
        <img src="<%= user.profilePicture %>" class="profile-pic rounded-circle mb-3" alt="Profile Picture">
        <h2 class="fw-bold"><%= user.username %></h2>
        <p class="text-muted"><%= user.email %></p>
        <hr class="w-50 mx-auto">
        <p class="mb-1"><strong>Course:</strong> <%= user.course || 'N/A' %></p>
        <p class="mb-1"><strong>Year:</strong> <%= user.currentYear || 'N/A' %></p>
        <p><strong>College:</strong> <%= user.institute %></p>
      </div>
      <div id="projects" class="section">
        <h2>My Skills & Projects</h2>
        <hr>
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
          <% if (user.projects && user.projects.length > 0) { %>
            <% user.projects.forEach(project => { %>
              <div class="col">
                <div class="card h-100">
                  <img src="<%= project.image %>" class="card-img-top" alt="<%= project.title %>" style="height: 200px; object-fit: cover;">
                  <div class="card-body d-flex flex-column">
                    <h5 class="card-title"><%= project.title %></h5>
                    <p class="card-text"><%= project.description %></p>
                    <a href="<%= project.link %>" target="_blank" class="btn mt-auto" style="background-color: var(--stumni-dark-blue); color: white;">View Project</a>
                  </div>
                </div>
              </div>
            <% }); %>
          <% } %>
        </div>
      </div>
      <div id="events" class="section">
        <h2>Upcoming Events</h2>
        <hr>
        <% if (events && events.length > 0) { %>
          <% events.forEach(event => { %>
            <div class="card mb-3">
              <div class="row g-0">
                <div class="col-md-3 d-flex flex-column justify-content-center align-items-center text-white p-3" style="background-color: var(--stumni-dark-blue);">
                  <span class="fs-1 fw-bold"><%= new Date(event.date).getDate() %></span>
                  <span class="fs-5 text-uppercase"><%= new Date(event.date).toLocaleString('default', { month: 'short' }) %></span>
                </div>
                <div class="col-md-9">
                  <div class="card-body">
                    <h5 class="card-title"><%= event.name %></h5>
                    <p class="card-text mb-1"><small class="text-muted"><strong>Hosted by:</strong> <%= event.hostedBy %></small></p>
                    <p class="card-text"><small class="text-muted"><strong>Venue:</strong> <%= event.venue %></small></p>
                    <form action="/student/register-event/<%= event._id %>/<%= user._id %>" method="POST">
                        <button type="submit" class="btn btn-register btn-primary">Register</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          <% }); %>
        <% } %>
      </div>
      <div id="mentors" class="section">
        <h2>Find a Mentor</h2>
        <hr>
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4">
          <% if (mentors && mentors.length > 0) { %>
            <% mentors.forEach(mentor => { %>
              <div class="col">
                <div class="card text-center h-100">
                  <div class="card-body">
                     <img src="<%= mentor.profilePicture %>" class="rounded-circle mb-2" width="80" height="80" alt="Mentor">
                     <h5 class="card-title"><%= mentor.username %></h5>
                     <p class="card-text text-muted small"><%= mentor.currentJob.title %> at <%= mentor.currentJob.company %></p>
                     <% if (pendingMentorIds.includes(mentor._id.toString())) { %>
                        <button class="btn btn-sm btn-outline-secondary" disabled>Request Sent</button>
                     <% } else { %>
                        <form action="/student/mentor-request/<%= mentor._id %>/<%= user._id %>" method="POST">
                            <button type="submit" class="btn btn-sm btn-outline-primary">Send Request</button>
                        </form>
                     <% } %>
                  </div>
                </div>
              </div>
            <% }); %>
          <% } %>
        </div>
      </div>
    </main>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const sidebarLinks = document.querySelectorAll('#sidebarMenu .nav-link[data-target]');
    sidebarLinks.forEach(link => {
      link.addEventListener('click', function (e) {
        e.preventDefault();
        document.querySelectorAll('.sidebar .nav-link').forEach(el => el.classList.remove('active'));
        this.classList.add('active');
        document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
        const targetId = this.getAttribute('data-target');
        document.getElementById(targetId).classList.add('active');
      });
    });
  });
</script>
</body>
</html>