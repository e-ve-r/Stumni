<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <style>
    :root { --stumni-dark-blue: #0A2540; --stumni-gold: #FFC107; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8f9fa; }
    .sidebar { background-color: var(--stumni-dark-blue); color: white; }
    .sidebar .nav-link { color: white; font-weight: 500; }
    .sidebar .nav-link:hover, .sidebar .nav-link.active { background-color: var(--stumni-gold); color: var(--stumni-dark-blue); border-radius: 5px; }
    @media (min-width: 768px) { .sidebar { min-height: 100vh; } }
    .content { padding: 2rem; }
    .section { display: none; }
    .section.active { display: block; }
  </style>
</head>
<body>
<div class="container-fluid">
  <div class="row">
    <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse p-3">
      <h3 class="text-center mb-4 d-none d-md-block">Admin Panel</h3>
      <ul class="nav flex-column">
        <li class="nav-item"><a class="nav-link active" href="#" data-target="overview"><i class="bi bi-grid-1x2-fill me-2"></i> Overview</a></li>
        <li class="nav-item"><a class="nav-link" href="#" data-target="users"><i class="bi bi-people-fill me-2"></i> User Management</a></li>
        <li class="nav-item"><a class="nav-link" href="#" data-target="events"><i class="bi bi-calendar-plus-fill me-2"></i> Event Management</a></li>
        <li class="nav-item mt-auto"><a class="nav-link" href="/"><i class="bi bi-box-arrow-left me-2"></i> Logout</a></li>
      </ul>
    </nav>
    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 content">
      <h2 class="border-bottom pb-2 mb-4">Hello, <%= user.username %> ðŸ‘‹ (Admin)</h2>
      
      <div id="overview" class="section active">
        <h3 class="mb-4">Dashboard Overview</h3>
        <div class="row g-4">
          <div class="col-md-6 col-xl-3"><div class="card h-100"><div class="card-body"><h5 class="card-title text-muted">Total Users</h5><p class="card-text fs-2 fw-bold"><%= stats.total %></p></div></div></div>
          <div class="col-md-6 col-xl-3"><div class="card h-100"><div class="card-body"><h5 class="card-title text-muted">Students</h5><p class="card-text fs-2 fw-bold"><%= stats.students %></p></div></div></div>
          <div class="col-md-6 col-xl-3"><div class="card h-100"><div class="card-body"><h5 class="card-title text-muted">Alumni</h5><p class="card-text fs-2 fw-bold"><%= stats.alumni %></p></div></div></div>
          <div class="col-md-6 col-xl-3"><div class="card h-100"><div class="card-body"><h5 class="card-title text-muted">Upcoming Events</h5><p class="card-text fs-2 fw-bold"><%= stats.events %></p></div></div></div>
        </div>
      </div>
      
      <div id="users" class="section">
        <h3 class="mb-4">User Management</h3>
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light"><tr><th>Name</th><th>Email</th><th>Role</th><th>Actions</th></tr></thead>
                <tbody>
                  <% users.forEach(u => { %>
                    <tr>
                        <td><%= u.username %></td>
                        <td><%= u.email %></td>
                        <td>
                          <% if(u.role === 'student') { %><span class="badge bg-warning text-dark">Student</span><% } else { %><span class="badge bg-success">Alumni</span><% } %>
                        </td>
                        <td>
                            <form action="/admin/users/delete/<%= u._id %>/<%= user._id %>" method="POST" class="d-inline">
                                <button type="submit" class="btn btn-sm btn-outline-danger" title="Delete User"><i class="bi bi-trash"></i></button>
                            </form>
                        </td>
                    </tr>
                  <% }); %>
                </tbody>
            </table>
        </div>
      </div>
      
      <div id="events" class="section">
        <h3 class="mb-4">Event Management</h3>
        <div class="row">
            <div class="col-lg-4 mb-4">
                <div class="card">
                    <div class="card-header fw-bold">Add New Event</div>
                    <div class="card-body">
                        <form action="/admin/events/create/<%= user._id %>" method="POST">
                            <div class="mb-3"><label for="eventName" class="form-label">Event Name</label><input type="text" name="eventName" class="form-control" id="eventName" required></div>
                            <div class="mb-3"><label for="eventHost" class="form-label">Hosted By</label><input type="text" name="eventHost" class="form-control" id="eventHost" required></div>
                            <div class="mb-3"><label for="eventVenue" class="form-label">Venue</label><input type="text" name="eventVenue" class="form-control" id="eventVenue" required></div>
                             <div class="mb-3"><label for="eventDate" class="form-label">Date</label><input type="date" name="eventDate" class="form-control" id="eventDate" required></div>
                            <button type="submit" class="btn w-100" style="background-color: var(--stumni-dark-blue); color: white;">Create Event</button>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-lg-8">
                 <h5 class="mb-3">Current Events</h5>
                 <% events.forEach(event => { %>
                  <div class="d-flex justify-content-between align-items-center p-2 border rounded mb-2">
                      <div>
                          <strong><%= event.name %></strong>
                          <small class="d-block text-muted"><%= new Date(event.date).toLocaleDateString() %> | Venue: <%= event.venue %></small>
                      </div>
                      <form action="/admin/events/delete/<%= event._id %>/<%= user._id %>" method="POST">
                          <button type="submit" class="btn btn-sm btn-outline-danger" title="Delete Event"><i class="bi bi-trash"></i></button>
                      </form>
                  </div>
                <% }); %>
            </div>
        </div>
      </div>
    </main>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const sidebarLinks = document.querySelectorAll('#sidebarMenu .nav-link[data-target]');
    sidebarLinks.forEach(link => {
      link.addEventListener('click', function (e) {
        e.preventDefault();
        document.querySelectorAll('.sidebar .nav-link').forEach(el => el.classList.remove('active'));
        this.classList.add('active');
        document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
        const targetId = this.getAttribute('data-target');
        document.getElementById(targetId).classList.add('active');
      });
    });
  });
</script>
</body>
</html>